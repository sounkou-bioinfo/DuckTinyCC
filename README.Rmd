---
title: "DuckTinyCC"
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

# DuckTinyCC

DuckTinyCC is a DuckDB C extension with a `tcc_*` SQL surface.

The current implementation provides a session-oriented control plane through
`tcc_module(...)` and returns structured diagnostics rows for each operation.

## Build

```sh
make configure
make debug
```

## Test

```sh
make test_debug
```

## Usage from R (DBI)

```{r setup, message=FALSE, warning=FALSE}
library(DBI)
library(duckdb)
```

```{r connect}
db <- duckdb(config = list(allow_unsigned_extensions = "true"))
con <- dbConnect(
  db
)
dbExecute(con, "LOAD 'build/debug/capi_quack.duckdb_extension'")
```

For convenience in examples:

```{r helper}
q <- function(sql) dbGetQuery(con, sql)
```

### Inspect default session state

```{r ex-config-get-default}
q("SELECT ok, mode, code, detail FROM tcc_module(mode := 'config_get')")
```

### Set runtime path for this connection session

```{r ex-config-set}
q(
  "SELECT ok, mode, code, detail
   FROM tcc_module(
     mode := 'config_set',
     runtime_path := 'third_party/tinycc'
   )"
)
```

### Verify current session config

```{r ex-config-get-current}
q("SELECT ok, mode, code, detail FROM tcc_module(mode := 'config_get')")
```

### List current artifact registry state

```{r ex-list}
q("SELECT ok, mode, phase, code, message FROM tcc_module(mode := 'list')")
```

### Reset session configuration

```{r ex-config-reset}
q("SELECT ok, mode, code, detail FROM tcc_module(mode := 'config_reset')")
```

### Error diagnostics example (invalid mode)

```{r ex-invalid-mode}
q("SELECT ok, mode, phase, code, message FROM tcc_module(mode := 'unknown')")
```

## Notes

- The API is intentionally row-oriented and diagnostic-first, so it fits SQL
  workflows and test assertions.
- `compile/register` execution paths are being wired to TinyCC runtime next.

```{r cleanup}
dbDisconnect(con, shutdown = TRUE)
```
