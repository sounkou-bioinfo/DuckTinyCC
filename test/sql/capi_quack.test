# name: test/sql/capi_quack.test
# description: test capi_quack extension
# group: [capi_quack]

# Before we load the extension, this will fail
statement error
SELECT * FROM tcc_module(mode := 'config_get');
----
Catalog Error: Table Function with name tcc_module does not exist!

# Require statement will ensure the extension is loaded from now on
require capi_quack

# Confirm the extension works (default mode is config_get)
query TTT
SELECT ok, mode, code
FROM tcc_module();
----
true	config_get	OK

query TTTT
SELECT ok, mode, code, detail
FROM tcc_module(mode := 'config_set', runtime_path := '/tmp/tcc-runtime');
----
true	config_set	OK	/tmp/tcc-runtime

query TTTT
SELECT ok, mode, code, detail
FROM tcc_module(mode := 'config_get');
----
true	config_get	OK	/tmp/tcc-runtime

query TTT
SELECT ok, mode, code
FROM tcc_module(mode := 'compile');
----
false	compile	E_NOT_IMPLEMENTED
